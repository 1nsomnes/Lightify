<!DOCTYPE html>
<html>

<head>
  <script src="https://sdk.scdn.co/spotify-player.js"></script>

  <script>



    function playBeep() {
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      const ctx = new AudioCtx();
      const osc = ctx.createOscillator();
      osc.type = 'sine';
      osc.frequency.setValueAtTime(440, ctx.currentTime); // 440 Hz = A4
      osc.connect(ctx.destination);
      osc.start();
      osc.stop(ctx.currentTime + 0.2); // play for 0.2 seconds
    }

    function sayHello(name) {
      document.body.innerHTML = "<h1>Hello, " + name + "!</h1>";
      // send a message back to Flutter
      FlutterHost.postMessage("Greeted " + name);

      playBeep();
    }
    window.addEventListener('DOMContentLoaded', () => {
      playBeep();
    });


    window.onSpotifyWebPlaybackSDKReady = () => {
      const token = '{token}';

      console.log("current token = " + token)
      const player = new Spotify.Player({
        name: 'Lightify',
        getOAuthToken: cb => {cb(token);},
        volume: 1
      });
      console.log("spotify play back ready")

      player.addListener('ready', ({device_id}) => {
        console.log("ready with id " + device_id)
        window.spotifyPlayer = player;
      });

      player.addListener('not_ready', ({device_id}) => {
        console.log('Device ID has gone offline', device_id);
      });
      player.addListener('initialization_error', ({message}) => {
        console.error(message);
      });

      player.addListener('authentication_error', ({message}) => {
        console.error(message);
      });

      player.addListener('account_error', ({message}) => {
        console.error(message);
      });

      /*document.getElementById('togglePlay').onclick = function () {
        player.togglePlay();
      };*/

      player.connect();
    }

    function togglePlayback() {
      console.log("Toggling Play")
      window.spotifyPlayer.togglePlay();
    }

    function next() {
      console.log("Skipping song")
      window.spotifyPlayer.nextTrack();
    }

    function previous() {
      console.log("Going back a song")
      window.spotifyPlayer.previousTrack();
    }
  </script>
</head>

<body>
  <h1>Waiting...</h1>

  <button id="togglePlay">Toggle Play</button>
</body>

</html>
